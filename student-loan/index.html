<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Loan Modeller - UK Plan 1 Student Loan Strategy</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React and ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Prop-Types: MANDATORY for Recharts UMD builds -->
    <script src="https://unpkg.com/prop-types@15.8.1/prop-types.min.js"></script>
    <!-- Recharts Dependencies -->
    <script src="https://unpkg.com/recharts@2.12.7/umd/Recharts.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .recharts-cartesian-grid-horizontal line, .recharts-cartesian-grid-vertical line {
            stroke-opacity: 0.1;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;
        const { 
            LineChart, Line, XAxis, YAxis, CartesianGrid, 
            Tooltip, Legend, ResponsiveContainer, ReferenceLine 
        } = Recharts;

        const App = () => {
            const PLAN1_THRESHOLD = 24990; 
            const REPAYMENT_RATE = 0.09;

            const [darkMode, setDarkMode] = useState(false);
            const [isHowItWorksOpen, setIsHowItWorksOpen] = useState(true);

            const [loanBalance, setLoanBalance] = useState(25000);
            const [graduationYear, setGraduationYear] = useState(2015); 
            const [currentSalary, setCurrentSalary] = useState(45000);
            const [salaryGrowth, setSalaryGrowth] = useState(3);
            const [expectedInterest, setExpectedInterest] = useState(3.5); 
            const [investmentReturn, setInvestmentReturn] = useState(7);
            const [stopWorkingYear, setStopWorkingYear] = useState(2035);

            // Re-initialize Lucide icons on state changes
            useEffect(() => {
                if (window.lucide) {
                    window.lucide.createIcons();
                }
            }, [darkMode, isHowItWorksOpen]);

            const projections = useMemo(() => {
                let results = [];
                let balanceA = loanBalance;
                let investmentA = loanBalance; 
                let investmentB = 0; 

                const startYear = 2025;
                const endYear = 2042;
                let salary = currentSalary;
                
                const firstRepaymentApril = graduationYear + 1;
                const writeOffYear = firstRepaymentApril + 25;
                
                const totalIterations = endYear - startYear;

                for (let i = 0; i <= totalIterations; i++) {
                    const currentYear = startYear + i;
                    const isBeforeWriteOff = currentYear < writeOffYear;
                    const isAtWriteOff = currentYear === writeOffYear;
                    const isWorking = currentYear < stopWorkingYear;
                    
                    const annualRepayment = (isWorking && isBeforeWriteOff) ? Math.max(0, (salary - PLAN1_THRESHOLD) * REPAYMENT_RATE) : 0;
                    
                    if (i > 0) {
                        investmentA = investmentA * (1 + investmentReturn / 100);
                        investmentB = investmentB * (1 + investmentReturn / 100);
                        
                        if (balanceA > 0 && isBeforeWriteOff) {
                            const interestCharge = balanceA * (expectedInterest / 100);
                            const actualPayment = Math.min(balanceA + interestCharge, annualRepayment);
                            balanceA = balanceA + interestCharge - actualPayment;
                        } 
                        
                        if (isWorking) {
                            investmentB = investmentB + annualRepayment;
                        }
                    }

                    const currentDebtA = isBeforeWriteOff ? balanceA : 0;
                    const netWorthA = investmentA - currentDebtA;
                    const netWorthB = investmentB;

                    if (isAtWriteOff && currentYear >= 2025 && currentYear <= 2042) {
                        results.push({
                            displayYear: currentYear,
                            netGainA: Math.round(investmentA - balanceA),
                            netGainB: Math.round(netWorthB),
                            debtOnly: -Math.round(balanceA)
                        });
                        results.push({
                            displayYear: currentYear,
                            netGainA: Math.round(investmentA),
                            netGainB: Math.round(netWorthB),
                            debtOnly: 0
                        });
                    } else if (currentYear >= 2025 && currentYear <= 2042) {
                        results.push({
                            displayYear: currentYear,
                            netGainA: Math.round(netWorthA),
                            netGainB: Math.round(netWorthB),
                            debtOnly: -Math.round(currentDebtA),
                        });
                    }
                    if (isWorking && i > 0) salary = salary * (1 + salaryGrowth / 100);
                }
                return { data: results, writeOffYear };
            }, [loanBalance, graduationYear, currentSalary, salaryGrowth, expectedInterest, investmentReturn, stopWorkingYear]);

            const { data, writeOffYear } = projections;
            const finalStats = data[data.length - 1] || {};
            const winner = finalStats.netGainA > finalStats.netGainB ? 'A' : 'B';

            const glassStyle = darkMode 
                ? "bg-slate-900/40 backdrop-blur-xl border border-white/10" 
                : "bg-white/70 backdrop-blur-xl border border-white/40 shadow-xl shadow-slate-200/50";

            return (
                <div className={`min-h-screen transition-colors duration-500 p-4 md:p-8 ${darkMode ? 'bg-slate-950 text-slate-100' : 'bg-[#f8fafc] text-slate-900'}`}>
                    <div className="max-w-6xl mx-auto space-y-6">
                        
                        {/* Header */}
                        <header className="flex flex-col md:flex-row md:items-center justify-between gap-4">
                            <div className="flex items-center gap-4">
                                <div className={`p-3 rounded-2xl ${darkMode ? 'bg-blue-500/20 text-blue-400' : 'bg-blue-600 text-white'}`}>
                                    <i data-lucide="shield-check" style={{width: 32, height: 32}}></i>
                                </div>
                                <div>
                                    <h1 className="text-3xl font-black tracking-tight italic uppercase leading-none">Student Loan Modeller</h1>
                                    <p className={darkMode ? "text-slate-400" : "text-slate-500"}>UK Plan 1 Student Loan Strategy</p>
                                </div>
                            </div>
                            <button 
                                onClick={() => setDarkMode(!darkMode)}
                                className={`p-3 rounded-2xl transition-all duration-300 ${darkMode ? 'bg-slate-800 text-yellow-400 border border-white/10' : 'bg-white text-slate-600 shadow-md'}`}
                            >
                                <i data-lucide={darkMode ? "sun" : "moon"} style={{width: 20, height: 20}}></i>
                            </button>
                        </header>

                        {/* Collapsible How It Works */}
                        <div className={`rounded-[2.5rem] overflow-hidden transition-all duration-500 ${darkMode ? 'bg-slate-900/60 border border-white/10' : 'bg-slate-900 text-white shadow-2xl'}`}>
                            <button 
                                onClick={() => setIsHowItWorksOpen(!isHowItWorksOpen)}
                                className="w-full px-8 py-5 flex items-center justify-between hover:bg-white/5 transition-colors"
                            >
                                <div className="flex items-center gap-3">
                                    <i data-lucide="info" className="text-blue-400" style={{width: 24, height: 24}}></i>
                                    <span className="text-xl font-bold">How this tool works</span>
                                </div>
                                <i data-lucide={isHowItWorksOpen ? "chevron-up" : "chevron-down"} style={{width: 24, height: 24}}></i>
                            </button>
                            
                            <div className={`transition-all duration-500 ease-in-out ${isHowItWorksOpen ? 'max-h-[1000px] opacity-100' : 'max-h-0 opacity-0 pointer-events-none'}`}>
                                <div className="px-8 pb-8 pt-2">
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-10 text-sm leading-relaxed">
                                        <div className="space-y-4">
                                            <h4 className="font-bold border-b border-white/10 pb-2 text-slate-200 uppercase tracking-wider">Understanding the Comparison</h4>
                                            <p className="opacity-70">
                                                This tool models your total wealth over time. It compares keeping a lump sum of cash (<strong>Remain on Student Loan Plan</strong>) versus using that cash to eliminate your student debt immediately (<strong>Pay off student loan in full</strong>).
                                            </p>
                                        </div>
                                        <div className="space-y-4">
                                            <h4 className="font-bold border-b border-white/10 pb-2 text-slate-200 uppercase tracking-wider">What the Chart Shows</h4>
                                            <ul className="space-y-3 opacity-70">
                                                <li className="flex gap-2">
                                                    <span className="text-blue-400 font-bold">•</span>
                                                    <span><strong>Option A:</strong> Wealth grows as investments earn interest. In the "Write-off" year, your net worth jumps as the remaining liability is cancelled.</span>
                                                </li>
                                                <li className="flex gap-2">
                                                    <span className="text-emerald-400 font-bold">•</span>
                                                    <span><strong>Option B:</strong> Wealth grows through market compounding and the monthly reinvestment of "saved" repayments.</span>
                                                </li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                            {/* Inputs Column */}
                            <div className="lg:col-span-1 space-y-6">
                                <div className={`p-6 rounded-3xl ${glassStyle}`}>
                                    <h2 className="font-bold text-lg mb-6 flex items-center gap-2">
                                        <i data-lucide="calculator" className="text-blue-500" style={{width: 18, height: 18}}></i> Simulation Inputs
                                    </h2>
                                    
                                    <div className="space-y-5">
                                        <div className="space-y-2">
                                            <span className="text-xs font-bold uppercase tracking-widest opacity-60">Current Balance & Pot (£)</span>
                                            <input type="number" value={loanBalance} onChange={(e) => setLoanBalance(Number(e.target.value))} className={`block w-full rounded-2xl px-4 py-3 border focus:ring-2 focus:ring-blue-500 outline-none transition-all ${darkMode ? 'bg-slate-800/50 border-white/10 text-white' : 'bg-slate-50 border-slate-200'}`} />
                                        </div>

                                        <div className="grid grid-cols-2 gap-4">
                                            <div className="space-y-2">
                                                <span className="text-xs font-bold uppercase tracking-widest opacity-60">Salary (£)</span>
                                                <input type="number" value={currentSalary} onChange={(e) => setCurrentSalary(Number(e.target.value))} className={`block w-full rounded-2xl px-4 py-3 border outline-none ${darkMode ? 'bg-slate-800/50 border-white/10 text-white' : 'bg-slate-50 border-slate-200'}`} />
                                            </div>
                                            <div className="space-y-2">
                                                <span className="text-xs font-bold uppercase tracking-widest opacity-60">Rise %</span>
                                                <input type="number" value={salaryGrowth} onChange={(e) => setSalaryGrowth(Number(e.target.value))} className={`block w-full rounded-2xl px-4 py-3 border outline-none ${darkMode ? 'bg-slate-800/50 border-white/10 text-white' : 'bg-slate-50 border-slate-200'}`} />
                                            </div>
                                        </div>

                                        <div className={`p-4 rounded-2xl ${darkMode ? 'bg-blue-500/10 border border-blue-500/20' : 'bg-blue-50 border border-blue-100'}`}>
                                            <div className="flex items-center justify-between mb-2">
                                                <span className="text-xs font-bold uppercase tracking-widest text-blue-500">Stop Working (Year)</span>
                                                <span className="text-blue-600 font-bold">{stopWorkingYear}</span>
                                            </div>
                                            <input type="range" min="2025" max="2060" value={stopWorkingYear} onChange={(e) => setStopWorkingYear(Number(e.target.value))} className="w-full accent-blue-600" />
                                        </div>

                                        <div className="pt-4 space-y-6 border-t border-slate-500/10">
                                            <div className="space-y-2">
                                                <div className="flex justify-between text-xs font-bold uppercase tracking-widest opacity-60">
                                                    <span>Debt Interest</span>
                                                    <span>{expectedInterest}%</span>
                                                </div>
                                                <input type="range" min="0" max="10" step="0.1" value={expectedInterest} onChange={(e) => setExpectedInterest(Number(e.target.value))} className="w-full h-2 rounded-lg appearance-none cursor-pointer accent-blue-600 bg-slate-500/20" />
                                            </div>
                                            <div className="space-y-2">
                                                <div className="flex justify-between text-xs font-bold uppercase tracking-widest opacity-60">
                                                    <span>Market Return</span>
                                                    <span>{investmentReturn}%</span>
                                                </div>
                                                <input type="range" min="0" max="15" step="0.5" value={investmentReturn} onChange={(e) => setInvestmentReturn(Number(e.target.value))} className="w-full h-2 rounded-lg appearance-none cursor-pointer accent-emerald-600 bg-slate-500/20" />
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div className={`p-6 rounded-3xl ${glassStyle}`}>
                                    <h3 className="text-sm font-bold mb-3 flex items-center gap-2">
                                        <i data-lucide="check-circle-2" className="text-emerald-500" style={{width: 16, height: 16}}></i> Key Metrics
                                    </h3>
                                    <div className="space-y-2 text-xs">
                                        <div className="flex justify-between">
                                            <span className="opacity-60">Write-off Year:</span>
                                            <span className="font-bold text-blue-500">{writeOffYear}</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className="opacity-60">Threshold:</span>
                                            <span className="font-bold">£{PLAN1_THRESHOLD.toLocaleString()}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {/* Visualization Column */}
                            <div className="lg:col-span-2 space-y-6">
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    {/* Option A Card */}
                                    <div className={`flex flex-col p-6 rounded-[2rem] border transition-all duration-500 ${
                                        winner === 'A' 
                                        ? 'bg-blue-600 border-blue-400 text-white shadow-lg ring-1 ring-white/20' 
                                        : (darkMode ? 'bg-slate-900/40 border-white/5' : 'bg-white border-slate-200 shadow-sm')
                                    }`}>
                                        <div className="flex justify-between items-center mb-4">
                                            <div className={`px-3 py-1 rounded-full text-[10px] font-black tracking-widest uppercase ${winner === 'A' ? 'bg-white/20' : 'bg-blue-500/10 text-blue-500'}`}>
                                                Option A
                                            </div>
                                            {winner === 'A' && <i data-lucide="award" className="animate-pulse" style={{width: 20, height: 20}}></i>}
                                        </div>
                                        <h3 className="text-xl font-bold mb-2">Remain on Student Loan Plan</h3>
                                        <p className={`text-sm leading-relaxed mb-6 flex-grow ${winner === 'A' ? 'text-blue-50' : 'text-slate-500'}`}>
                                            Invest the £{loanBalance.toLocaleString()} today and make salary repayments until the debt is cleared or cancelled in {writeOffYear}.
                                        </p>
                                        <div className={`mt-auto p-4 rounded-2xl ${winner === 'A' ? 'bg-white/10' : (darkMode ? 'bg-slate-900/60' : 'bg-slate-50')}`}>
                                            <p className="text-[10px] uppercase font-bold tracking-widest opacity-60 mb-1">Final Net Worth</p>
                                            <p className="text-3xl font-black">£{finalStats.netGainA?.toLocaleString()}</p>
                                        </div>
                                    </div>

                                    {/* Option B Card */}
                                    <div className={`flex flex-col p-6 rounded-[2rem] border transition-all duration-500 ${
                                        winner === 'B' 
                                        ? 'bg-emerald-600 border-emerald-400 text-white shadow-lg ring-1 ring-white/20' 
                                        : (darkMode ? 'bg-slate-900/40 border-white/5' : 'bg-white border-slate-200 shadow-sm')
                                    }`}>
                                        <div className="flex justify-between items-center mb-4">
                                            <div className={`px-3 py-1 rounded-full text-[10px] font-black tracking-widest uppercase ${winner === 'B' ? 'bg-white/20' : 'bg-emerald-500/10 text-emerald-500'}`}>
                                                Option B
                                            </div>
                                            {winner === 'B' && <i data-lucide="award" className="animate-pulse" style={{width: 20, height: 20}}></i>}
                                        </div>
                                        <h3 className="text-xl font-bold mb-2">Pay off student loan in full</h3>
                                        <p className={`text-sm leading-relaxed mb-6 flex-grow ${winner === 'B' ? 'text-emerald-50' : 'text-slate-500'}`}>
                                            Use your savings to clear the debt today. Reinvest your monthly savings back into the stock market.
                                        </p>
                                        <div className={`mt-auto p-4 rounded-2xl ${winner === 'B' ? 'bg-white/10' : (darkMode ? 'bg-slate-900/60' : 'bg-slate-50')}`}>
                                            <p className="text-[10px] uppercase font-bold tracking-widest opacity-60 mb-1">Final Net Worth</p>
                                            <p className="text-3xl font-black">£{finalStats.netGainB?.toLocaleString()}</p>
                                        </div>
                                    </div>
                                </div>

                                <div className={`p-6 rounded-3xl ${glassStyle}`}>
                                    <h3 className="font-bold text-lg mb-6 flex items-center gap-2">
                                        <i data-lucide="trending-up" className="text-blue-500" style={{width: 20, height: 20}}></i> Net Worth Projection
                                    </h3>
                                    <div className="h-96 w-full">
                                        <ResponsiveContainer width="100%" height="100%">
                                            <LineChart data={data}>
                                                <CartesianGrid strokeDasharray="3 3" vertical={false} stroke={darkMode ? "rgba(255,255,255,0.05)" : "#f1f5f9"} />
                                                <XAxis dataKey="displayYear" stroke={darkMode ? "#475569" : "#94a3b8"} fontSize={11} tickMargin={15} type="number" domain={[2025, 2042]} allowDuplicatedCategory={false} />
                                                <YAxis stroke={darkMode ? "#475569" : "#94a3b8"} fontSize={11} tickFormatter={(val) => `£${val/1000}k`} />
                                                <Tooltip 
                                                    contentStyle={{ backgroundColor: darkMode ? '#0f172a' : '#ffffff', borderRadius: '16px', border: 'none', boxShadow: '0 10px 25px rgba(0,0,0,0.1)' }}
                                                    labelFormatter={(label, payload) => payload && payload.length > 0 ? `Year: ${payload[0].payload.displayYear}` : `Year: ${label}`}
                                                    formatter={(value, name) => [`£${Math.round(value).toLocaleString()}`, name]}
                                                />
                                                <Legend verticalAlign="top" height={40} iconType="circle" wrapperStyle={{ fontSize: '11px', fontWeight: 'bold' }} />
                                                <ReferenceLine y={0} stroke={darkMode ? "rgba(255,255,255,0.1)" : "#64748b"} />
                                                <ReferenceLine 
                                                    x={writeOffYear} 
                                                    stroke={darkMode ? "#475569" : "#94a3b8"} 
                                                    strokeDasharray="3 3" 
                                                    label={{ 
                                                        value: 'Debt Cancellation', 
                                                        position: 'top', 
                                                        fill: darkMode ? '#94a3b8' : '#64748b', 
                                                        fontSize: 10,
                                                        fontWeight: 'bold'
                                                    }} 
                                                />
                                                
                                                <Line name="Option A: Remain on Plan" type="monotone" dataKey="netGainA" stroke="#3b82f6" strokeWidth={3} dot={false} isAnimationActive={false} />
                                                <Line name="Option B: Pay Off in Full" type="monotone" dataKey="netGainB" stroke="#10b981" strokeWidth={3} dot={false} isAnimationActive={false} />
                                                <Line name="Student Loan Debt" type="stepAfter" dataKey="debtOnly" stroke="#ef4444" strokeWidth={2} strokeDasharray="4 4" dot={false} opacity={0.5} isAnimationActive={false} />
                                            </LineChart>
                                        </ResponsiveContainer>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
