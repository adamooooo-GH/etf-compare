<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Plan 1 Student Loan Modeller</title>
  
  <!-- Tailwind CSS for Styling -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- React, Prop-Types & Recharts Dependencies -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prop-types/15.8.1/prop-types.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/recharts/2.10.3/Recharts.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.2/babel.min.js"></script>

  <!-- Typography -->
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;700;800&display=swap" rel="stylesheet">

  <style>
    body { font-family: 'DM Sans', sans-serif; }
    .glass-card {
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
    }
    input::-webkit-outer-spin-button,
    input::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useMemo, useEffect } = React;
    const { 
      XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, AreaChart, Area 
    } = Recharts;

    const I = {
      bank: "M3 21h18M3 10h18M5 10v11M9 10v11M13 10v11M17 10v11M12 3l8 7H4l8-7z",
      calc: "M19 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2zM9 7h6M9 11h6M9 15h6",
      chart: "M18 20V10M12 20V4M6 20v-6",
      user: "M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2M12 7a4 4 0 0 1 0 8 4 4 0 0 1 0-8z",
      help: "M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10zm0-15v.01M12 10c0 1.5.5 2 1 2.5s1 1 1 2.5",
      arrow: "M5 12h14M12 5l7 7-7 7",
      shield: "M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z",
      history: "M12 8v4l3 3m6-3a9 9 0 1 1-9-9c2.52 0 4.85.83 6.72 2.24L21 3",
      check: "M20 6L9 17l-5-5",
      sun: "M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42M12 7a5 5 0 1 0 0 10 5 5 0 0 0 0-10z",
      moon: "M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"
    };

    const Icon = ({ d, size = 18, color = "currentColor", className = "" }) => (
      <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <path d={d} />
      </svg>
    );

    const App = () => {
      // Repayment threshold for Plan 1 (2025/26)
      const THRESHOLD_2025 = 26065;
      const REPAYMENT_RATE = 0.09;
      const WRITE_OFF_WINDOW = 25; 

      const [gradYear, setGradYear] = useState(2015);
      const [currentBalance, setCurrentBalance] = useState(20000);
      const [currentSalary, setCurrentSalary] = useState(50000);
      const [salaryGrowth, setSalaryGrowth] = useState(3);
      const [expectedRpi, setExpectedRpi] = useState(3.2); 
      const [investmentReturn, setInvestmentReturn] = useState(7);
      const [retirementYear, setRetirementYear] = useState(2041);

      const [isDarkMode, setIsDarkMode] = useState(false);
      const [showTutorial, setShowTutorial] = useState(false);

      useEffect(() => {
        const hasSeenTutorial = localStorage.getItem('hasSeenStudentLoanTutorial');
        if (!hasSeenTutorial) setShowTutorial(true);
        if (window.matchMedia('(prefers-color-scheme: dark)').matches) setIsDarkMode(true);
      }, []);

      const closeTutorial = () => {
        setShowTutorial(false);
        localStorage.setItem('hasSeenStudentLoanTutorial', 'true');
      };

      const currentYear = new Date().getFullYear();

      const comparisonData = useMemo(() => {
        let results = [];
        let loanBalA = parseFloat(currentBalance) || 0;
        let investmentBalA = parseFloat(currentBalance) || 0; 
        let investmentBalB = 0; 
        
        const writeOffYear = parseInt(gradYear) + 1 + WRITE_OFF_WINDOW;
        const yearsToSimulate = Math.max(1, (writeOffYear - currentYear) + 5);

        for (let i = 0; i < yearsToSimulate; i++) {
          const year = currentYear + i;
          const isPostWriteOff = year > writeOffYear;
          const isActiveSalary = year < parseInt(retirementYear);
          const salaryThisYear = isActiveSalary ? currentSalary * Math.pow(1 + (salaryGrowth / 100), i) : 0;
          
          const interestRate = isPostWriteOff ? 0 : (expectedRpi / 100);
          const interestAdded = loanBalA * interestRate;
          const annualRepayment = (isActiveSalary && !isPostWriteOff) 
            ? Math.max(0, (salaryThisYear - THRESHOLD_2025) * REPAYMENT_RATE) 
            : 0;
          
          if (loanBalA > 0 && !isPostWriteOff) {
            const actualRepayment = Math.min(loanBalA + interestAdded, annualRepayment);
            loanBalA = Math.max(0, loanBalA + interestAdded - actualRepayment);
          } else if (isPostWriteOff) {
            loanBalA = 0;
          }

          investmentBalA = investmentBalA * (1 + investmentReturn / 100);
          investmentBalB = (investmentBalB * (1 + investmentReturn / 100)) + (isActiveSalary && !isPostWriteOff ? annualRepayment : 0);

          results.push({
            year,
            remainingDebt: Math.round(-loanBalA),
            netWealthA: Math.round(investmentBalA - loanBalA),
            netWealthB: Math.round(investmentBalB),
          });
        }
        return results;
      }, [currentBalance, currentSalary, salaryGrowth, expectedRpi, investmentReturn, retirementYear, gradYear]);

      const finalStats = useMemo(() => comparisonData[comparisonData.length - 1], [comparisonData]);
      const winA = finalStats.netWealthA > finalStats.netWealthB;

      const themeClass = isDarkMode ? "bg-[#0f172a] text-[#f8fafc]" : "bg-[#f1f5f9] text-[#1e293b]";
      const cardClass = isDarkMode 
        ? "bg-slate-900/60 border-slate-800 shadow-2xl glass-card" 
        : "bg-white/70 border-white shadow-xl shadow-slate-200/50 glass-card";
      const inputClass = `w-full ${isDarkMode ? 'bg-slate-800/50 border-slate-700 text-white' : 'bg-white/50 border-slate-200/60 text-slate-900'} border p-2.5 rounded-xl font-medium outline-none focus:ring-2 focus:ring-indigo-500/20 focus:border-indigo-500 transition-all text-sm`;
      const labelClass = "block text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-1.5 ml-1";

      return (
        <div className={`min-h-screen transition-colors duration-500 ${themeClass}`}>
          {/* Background Orbs */}
          <div className="fixed inset-0 overflow-hidden pointer-events-none">
            <div className={`absolute top-[-10%] left-[-10%] w-[40%] h-[40%] rounded-full blur-[120px] opacity-40 ${isDarkMode ? 'bg-indigo-950' : 'bg-indigo-200'} animate-pulse`} />
            <div className={`absolute bottom-[-10%] right-[-10%] w-[50%] h-[50%] rounded-full blur-[120px] opacity-30 ${isDarkMode ? 'bg-emerald-950' : 'bg-emerald-100'}`} />
          </div>

          <div className="relative z-10 max-w-6xl mx-auto px-6 py-12">
            <header className="mb-12 flex flex-col md:flex-row md:items-end justify-between gap-6 border-b border-slate-200/20 pb-10">
              <div>
                <div className="flex items-center gap-3 mb-2">
                  <div className="p-2.5 bg-indigo-600 rounded-2xl shadow-lg">
                    <Icon d={I.bank} size={24} color="white" />
                  </div>
                  <span className="text-[11px] font-black text-indigo-600 uppercase tracking-[0.2em]">Strategy Lab</span>
                </div>
                <h1 className={`text-4xl font-extrabold tracking-tight ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>Plan 1 Loan <span className="text-slate-400 font-medium">Modeller</span></h1>
              </div>
              <div className="flex items-center gap-4">
                <button 
                  onClick={() => setIsDarkMode(!isDarkMode)}
                  className={`p-3 rounded-2xl transition-all border ${isDarkMode ? 'bg-slate-800 border-slate-700 text-yellow-400' : 'bg-white border-slate-200 text-slate-600'}`}
                  aria-label="Toggle Theme"
                >
                  <Icon d={isDarkMode ? I.sun : I.moon} size={20} color="currentColor" />
                </button>
              </div>
            </header>

            <div className="grid grid-cols-1 lg:grid-cols-12 gap-8">
              {/* Sidebar Inputs */}
              <div className="lg:col-span-4 space-y-6">
                <div className={`p-8 rounded-[32px] border ${cardClass}`}>
                  <label className={labelClass}>Graduation Year</label>
                  <input type="number" value={gradYear} onChange={e => setGradYear(e.target.value)} className={inputClass} />
                  <div className="mt-4">
                    <label className={labelClass}>Current Balance (£)</label>
                    <input type="number" value={currentBalance} onChange={e => setCurrentBalance(e.target.value)} className={inputClass} />
                  </div>
                  <div className="mt-4">
                    <label className={labelClass}>Salary (£)</label>
                    <input type="number" value={currentSalary} onChange={e => setCurrentSalary(e.target.value)} className={inputClass} />
                  </div>
                </div>

                <div className={`p-8 rounded-[32px] border ${cardClass}`}>
                  <h2 className="text-[11px] font-black text-slate-400 uppercase tracking-widest mb-6">Assumptions</h2>
                  <div className="grid grid-cols-2 gap-4">
                    <div>
                      <label className={labelClass}>Growth %</label>
                      <input type="number" step="0.5" value={salaryGrowth} onChange={e => setSalaryGrowth(e.target.value)} className={inputClass} />
                    </div>
                    <div>
                      <label className={labelClass}>Interest %</label>
                      <input type="number" step="0.1" value={expectedRpi} onChange={e => setExpectedRpi(e.target.value)} className={inputClass} />
                    </div>
                  </div>
                  <div className="mt-4">
                    <label className={labelClass}>Market Return %</label>
                    <input type="number" step="0.5" value={investmentReturn} onChange={e => setInvestmentReturn(e.target.value)} className={inputClass} />
                  </div>
                </div>
              </div>

              {/* Main Display */}
              <div className="lg:col-span-8 space-y-8">
                <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <div className={`p-8 rounded-[32px] border-2 transition-all ${winA ? 'border-indigo-500 bg-indigo-500/5' : 'border-transparent bg-white/5'}`}>
                    <h3 className={`font-extrabold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>Stay on monthly</h3>
                    <p className={`text-3xl font-black mt-2 ${winA ? 'text-indigo-500' : 'text-slate-400'}`}>£{finalStats.netWealthA.toLocaleString()}</p>
                    <p className="text-[10px] text-slate-500 font-bold uppercase mt-1 tracking-wider">Path A Net Wealth</p>
                  </div>
                  <div className={`p-8 rounded-[32px] border-2 transition-all ${!winA ? 'border-emerald-500 bg-emerald-500/5' : 'border-transparent bg-white/5'}`}>
                    <h3 className={`font-extrabold ${isDarkMode ? 'text-white' : 'text-slate-900'}`}>Lump sum payoff</h3>
                    <p className={`text-3xl font-black mt-2 ${!winA ? 'text-emerald-500' : 'text-slate-400'}`}>£{finalStats.netWealthB.toLocaleString()}</p>
                    <p className="text-[10px] text-slate-500 font-bold uppercase mt-1 tracking-wider">Path B Net Wealth</p>
                  </div>
                </div>

                <div className={`p-10 rounded-[40px] border transition-all ${cardClass}`}>
                  <div className="h-[380px] w-full">
                    <ResponsiveContainer width="100%" height="100%">
                      <AreaChart data={comparisonData}>
                        <defs>
                          <linearGradient id="colorA" x1="0" y1="0" x2="0" y2="1">
                            <stop offset="5%" stopColor="#6366f1" stopOpacity={0.15}/>
                            <stop offset="95%" stopColor="#6366f1" stopOpacity={0}/>
                          </linearGradient>
                          <linearGradient id="colorB" x1="0" y1="0" x2="0" y2="1">
                            <stop offset="5%" stopColor="#10b981" stopOpacity={0.15}/>
                            <stop offset="95%" stopColor="#10b981" stopOpacity={0}/>
                          </linearGradient>
                        </defs>
                        <CartesianGrid strokeDasharray="6 6" vertical={false} stroke={isDarkMode ? "#334155" : "#e2e8f0"} />
                        <XAxis 
                          dataKey="year" 
                          axisLine={false} 
                          tickLine={false} 
                          tick={{fill: '#94a3b8', fontSize: 11}} 
                          dy={15} 
                        />
                        <YAxis 
                          axisLine={false} 
                          tickLine={false} 
                          tick={{fill: '#94a3b8', fontSize: 11}} 
                          tickFormatter={v => `£${Math.abs(v)/1000}k`} 
                        />
                        <Tooltip 
                          contentStyle={{
                            borderRadius: '24px', 
                            border: 'none', 
                            backgroundColor: isDarkMode ? '#1e293b' : '#ffffff',
                            padding: '16px',
                            boxShadow: '0 10px 15px -3px rgba(0, 0, 0, 0.1)'
                          }} 
                          itemStyle={{ color: isDarkMode ? '#f1f5f9' : '#1e293b', fontSize: '12px' }}
                          formatter={(value, name) => [`£${value.toLocaleString()}`, name === 'netWealthA' ? 'Path A' : name === 'netWealthB' ? 'Path B' : 'Debt']}
                        />
                        <Area type="monotone" dataKey="netWealthA" stroke="#6366f1" fill="url(#colorA)" strokeWidth={4} />
                        <Area type="monotone" dataKey="netWealthB" stroke="#10b981" fill="url(#colorB)" strokeWidth={4} />
                        <Area type="monotone" dataKey="remainingDebt" stroke="#f43f5e" fill="#f43f5e" fillOpacity={0.1} strokeWidth={2} strokeDasharray="8 8" />
                      </AreaChart>
                    </ResponsiveContainer>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>